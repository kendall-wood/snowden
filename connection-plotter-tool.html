<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connection Point Plotter - Level 3 Part 2</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #1a1a1a;
            color: #00ff00;
            font-family: 'Courier New', monospace;
        }
        
        #container {
            display: flex;
            gap: 20px;
        }
        
        #canvas-wrapper {
            position: relative;
            border: 2px solid #00ff00;
            max-width: 1000px;
            max-height: 700px;
            overflow: auto;
        }
        
        canvas {
            display: block;
            cursor: crosshair;
            transform-origin: 0 0;
        }
        
        #controls {
            flex: 1;
            background-color: #000;
            padding: 20px;
            border: 2px solid #00ff00;
            max-width: 400px;
        }
        
        h1 {
            color: #00ff00;
            margin-top: 0;
        }
        
        button {
            background-color: #003300;
            color: #00ff00;
            border: 2px solid #00ff00;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            width: calc(100% - 10px);
        }
        
        button:hover {
            background-color: #005500;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        #output {
            background-color: #000;
            border: 1px solid #00ff00;
            padding: 10px;
            margin-top: 10px;
            max-height: 400px;
            overflow-y: auto;
            font-size: 12px;
        }
        
        .item-info {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #00ff00;
        }
        
        .instructions {
            border: 1px solid #ffff00;
            padding: 10px;
            margin: 10px 0;
            color: #ffff00;
        }
        
        .complete {
            color: #00ff00;
        }
        
        .incomplete {
            color: #ff0000;
        }
        
        .connection-pair {
            color: #ff0000;
            font-weight: bold;
        }
        
        .zoom-controls {
            border: 1px solid #00ff00;
            padding: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Connection Point Plotter - Level 3 Part 2</h1>
    
    <div id="container">
        <div id="canvas-wrapper">
            <canvas id="map-canvas"></canvas>
        </div>
        
        <div id="controls">
            <div class="instructions">
                <strong>INSTRUCTIONS:</strong><br>
                1. Click on map to place connection points<br>
                2. Place 16 points (8 pairs) total<br>
                3. Points auto-pair: 1A→1B, 2A→2B, etc.<br>
                4. Red dots show placement<br>
                5. Click "Generate Code" when done
            </div>
            
            <div id="status-info" class="item-info">
                <strong>Status:</strong><br>
                <span id="point-info">Click to place <span class="connection-pair">Connection 1A</span></span><br>
                Points Placed: <span id="point-count" class="incomplete">0/16</span><br>
                Pairs Complete: <span id="pair-count" class="incomplete">0/8</span>
            </div>
            
            <div class="zoom-controls">
                <strong>Zoom:</strong><br>
                <button id="zoom-out-btn">Zoom Out (-)</button>
                <button id="zoom-in-btn">Zoom In (+)</button>
                <button id="fit-btn">Fit to Screen</button>
                <br><span id="zoom-level">Zoom: 100%</span>
            </div>
            
            <div style="border-top: 1px solid #00ff00; padding-top: 10px;">
                <strong>Actions:</strong><br>
                <button id="undo-btn">Undo Last Point</button>
                <button id="clear-btn">Clear All Points</button>
                <button id="generate-btn">Generate Code</button>
            </div>
            
            <div id="output"></div>
        </div>
    </div>
    
    <script>
        const canvas = document.getElementById('map-canvas');
        const ctx = canvas.getContext('2d');
        const output = document.getElementById('output');
        const pointInfo = document.getElementById('point-info');
        const pointCountSpan = document.getElementById('point-count');
        const pairCountSpan = document.getElementById('pair-count');
        const zoomLevelSpan = document.getElementById('zoom-level');
        
        // Level 3 map configuration
        const mapFile = 'assets/lvl-3.1-map.png';  // Using open door version for Part 2
        const mapWidth = 6315;
        const mapHeight = 4467;
        
        // Zoom level
        let zoomLevel = 0.25;  // Start at 25%
        
        // Connection points array (16 points = 8 pairs)
        let connectionPoints = [];
        
        // Load and draw map
        const mapImage = new Image();
        mapImage.src = mapFile;
        mapImage.onload = () => {
            canvas.width = mapWidth;
            canvas.height = mapHeight;
            updateZoom();
            redrawCanvas();
        };
        
        // Update zoom
        function updateZoom() {
            canvas.style.transform = `scale(${zoomLevel})`;
            canvas.style.width = `${mapWidth}px`;
            canvas.style.height = `${mapHeight}px`;
            zoomLevelSpan.textContent = `Zoom: ${Math.round(zoomLevel * 100)}%`;
        }
        
        // Zoom controls
        document.getElementById('zoom-in-btn').addEventListener('click', () => {
            zoomLevel = Math.min(zoomLevel + 0.1, 1.0);
            updateZoom();
        });
        
        document.getElementById('zoom-out-btn').addEventListener('click', () => {
            zoomLevel = Math.max(zoomLevel - 0.1, 0.1);
            updateZoom();
        });
        
        document.getElementById('fit-btn').addEventListener('click', () => {
            zoomLevel = 0.25;
            updateZoom();
        });
        
        function redrawCanvas() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw map
            ctx.drawImage(mapImage, 0, 0, canvas.width, canvas.height);
            
            // Draw all connection points
            connectionPoints.forEach((point, index) => {
                const pairNumber = Math.floor(index / 2) + 1;
                const isFirst = index % 2 === 0;
                const label = `${pairNumber}${isFirst ? 'A' : 'B'}`;
                
                // Draw red circle (smaller than documents)
                ctx.fillStyle = 'rgba(255, 0, 0, 0.6)';
                ctx.strokeStyle = '#ff0000';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(point.x, point.y, 15, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();
                
                // Draw label
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(label, point.x, point.y - 25);
            });
            
            // Draw lines between pairs
            for (let i = 0; i < connectionPoints.length; i += 2) {
                if (i + 1 < connectionPoints.length) {
                    const pointA = connectionPoints[i];
                    const pointB = connectionPoints[i + 1];
                    
                    ctx.strokeStyle = 'rgba(255, 0, 0, 0.4)';
                    ctx.lineWidth = 3;
                    ctx.setLineDash([15, 8]);
                    ctx.beginPath();
                    ctx.moveTo(pointA.x, pointA.y);
                    ctx.lineTo(pointB.x, pointB.y);
                    ctx.stroke();
                    ctx.setLineDash([]);
                }
            }
            
            updatePointInfo();
        }
        
        function updatePointInfo() {
            const nextIndex = connectionPoints.length;
            const completePairs = Math.floor(nextIndex / 2);
            
            // Update counts
            pointCountSpan.textContent = `${nextIndex}/16`;
            pointCountSpan.className = nextIndex === 16 ? 'complete' : 'incomplete';
            
            pairCountSpan.textContent = `${completePairs}/8`;
            pairCountSpan.className = completePairs === 8 ? 'complete' : 'incomplete';
            
            // Update next placement text
            if (nextIndex >= 16) {
                pointInfo.innerHTML = '<span style="color: #00ff00;">✓ All 8 connection pairs placed!</span>';
            } else {
                const pairNumber = Math.floor(nextIndex / 2) + 1;
                const isFirst = nextIndex % 2 === 0;
                const label = `${pairNumber}${isFirst ? 'A' : 'B'}`;
                pointInfo.innerHTML = `Click to place <span class="connection-pair">Connection ${label}</span>`;
            }
        }
        
        // Handle canvas clicks
        canvas.addEventListener('click', (e) => {
            if (connectionPoints.length >= 16) {
                alert('All 16 connection points placed! Click "Generate Code" or "Clear All Points"');
                return;
            }
            
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const x = Math.round((e.clientX - rect.left) * scaleX);
            const y = Math.round((e.clientY - rect.top) * scaleY);
            
            connectionPoints.push({x, y});
            redrawCanvas();
        });
        
        // Clear all points
        document.getElementById('clear-btn').addEventListener('click', () => {
            connectionPoints = [];
            redrawCanvas();
            output.textContent = '';
        });
        
        // Undo last point
        document.getElementById('undo-btn').addEventListener('click', () => {
            if (connectionPoints.length > 0) {
                connectionPoints.pop();
                redrawCanvas();
            }
        });
        
        // Generate code
        document.getElementById('generate-btn').addEventListener('click', () => {
            if (connectionPoints.length !== 16) {
                output.textContent = `Error: Need exactly 16 points (8 pairs). Currently placed: ${connectionPoints.length}/16`;
                return;
            }
            
            let code = '// Level 3 Part 2 - Connection Points\n';
            code += '// Add this to LEVEL_CONFIGS[3] in game.js\n\n';
            code += 'part2ConnectionPoints: [\n';
            
            for (let i = 0; i < connectionPoints.length; i += 2) {
                const pointA = connectionPoints[i];
                const pointB = connectionPoints[i + 1];
                const pairNum = (i / 2) + 1;
                
                code += `    // Connection ${pairNum}\n`;
                code += `    {\n`;
                code += `        pointA: {x: ${pointA.x}, y: ${pointA.y}},\n`;
                code += `        pointB: {x: ${pointB.x}, y: ${pointB.y}}\n`;
                code += `    }${i < connectionPoints.length - 2 ? ',' : ''}\n`;
            }
            
            code += '],\n\n';
            code += '// Summary:\n';
            code += `// Total connections: 8 pairs (16 points)\n`;
            code += `// Timer: 45 seconds\n`;
            
            output.textContent = code;
        });
        
        updatePointInfo();
    </script>
</body>
</html>

